{% extends "dashboard_app/_content.html" %}
{% load i18n %}
{% load django_tables2 %}

{% block extrahead %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}dashboard_app/css/filter-edit.css" />
{{ block.super }}
<script type="text/javascript" src="{% url admin:jsi18n %}"></script>
<script type="text/javascript">
var django = {};
django.jQuery = $;
var test_case_url = "{% url dashboard_app.views.filter_add_cases_for_test_json %}?test=";
</script>
{{ form.media }}
<script type="text/javascript" src="{{ STATIC_URL }}dashboard_app/js/filter-edit.js"></script>
{% endblock %}

{% block content %}
{% if form.instance.pk %}
<h1>Previewing changes to filter &ldquo;{{ form.instance.name }}&rdquo;</h1>
{% else %}
<h1>Previewing new filter &ldquo;{{ form.name.value }}&rdquo;</h1>
{% endif %}

<table>
  <tr>
    <th>
      Bundle streams
    </th>
    <td>
    {% for r in form.cleaned_data.bundle_streams %}
        {{r.pathname}}{% if not forloop.last %}, {% endif %}
    {% endfor %}
    </td>
  </tr>
  <tr>
    <th>
      Attributes
    </th>
    <td>
    {% for a in form.attributes %}
    {{ a.0 }} = {{ a.1 }}  <br />
    {% empty %}
    No attribute matches required
    {% endfor %}
    </td>
  </tr>
  <tr>
    <th>
      Test cases
    </th>
    <td>
    {% if form.cleaned_data.test_case %}
        {{ form.cleaned_data.test }}:{{ form.cleaned_data.test_case }}
    {% elif form.cleaned_data.test %}
        {{ form.cleaned_data.test }}:&lt;any&gt;
    {% else %}
        &lt;any&gt;:&lt;any&gt;
    {% endif %}
    </td>
  </tr>
</table>

<p>
  These are the results matched by your filter.
</p>

{% render_table table %}

<p>

<form action="" method="post">
  <p>
    If this is what you expected, you can
    {% if form.instance.pk %}
    <input type="submit" name="save" value="save changes"> to the filter.
    {% else %}
    <input type="submit" name="save" value="save"> the filter.
    {% endif %}
  </p>
  <p>
    Otherwise, you can <a href="#" id="edit-link">edit</a> it.
  </p>
  {% csrf_token %}
  <div id="filter-edit" style="display: none">
    {% include "dashboard_app/filter_form.html" %}
    <input type="submit" name="preview" value="Preview again">
  </div>
</form>


<script type="text/javascript">
$("#edit-link").click(function (e) {
e.preventDefault();
$("#filter-edit").show();
});
</script>
{% endblock %}
