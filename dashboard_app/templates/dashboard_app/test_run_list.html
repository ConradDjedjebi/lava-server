{% extends "dashboard_app/_content.html" %}
{% load i18n %}
{% load humanize %}


{% block title %}
{{ block.super }} | {% trans "Streams" %} | {% trans "Bundle Stream" %} {{ bundle_stream.pathname }}
{% endblock %}


{% block breadcrumbs %}
<li><a href="{% url dashboard_app.views.bundle_stream_list %}">{% trans "Bundle Streams" %}</a></li>
<li><a href="{{ bundle_stream.get_absolute_url }}">{{ bundle_stream }}</a></li>
{% endblock %}


{% block content %}
<div id="master-toolbar-splice" >
  <span
    class="length"
    style="float:left; display:inline-block; width:30%; text-align:left;"></span>
  <span class="view-as">
    <input name="radio" type="radio" id="as_bundles"/>
    <label for="as_bundles">
      <a
        id="as_bundles_link"
        href="{% url dashboard_app.views.bundle_list bundle_stream.pathname %}"
        >{% trans "Bundles" %}</a>
    </label>
    <input name="radio" checked type="radio" id="as_test_runs"/>
    <label for="as_test_runs">
      <a
        id="as_test_runs_link"
        href="{% url dashboard_app.views.test_run_list bundle_stream.pathname %}"
        >{% trans "Test Runs" %}</a>
    </label>
  </span>
  <span
    class="search"
    style="float:right; display:inline-block; width: 30%; text-align:right"></span>
</div>
<script type="text/javascript" charset="utf-8"> 
  $(document).ready(function() {
    oTable = $('#test_runs').dataTable({
      bJQueryUI: true,
      sPaginationType: "full_numbers",
      aaSorting: [[1, "desc"]],
      iDisplayLength: 25,
      aLengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
      sDom: 'lfr<"#master-toolbar">t<"F"ip>'
    });
    // Try hard to make our radio boxes behave as links
    $("#master-toolbar-splice span.view-as").buttonset();
    $("#master-toolbar-splice span.view-as input").change(function(event) {
      var link = $("#" + event.target.id + "_link");
      location.href=link.attr("href");
    });
    // Insane splicing below
    $("div.dataTables_length").children().appendTo("#master-toolbar-splice span.length");
    $("div.dataTables_filter").children().appendTo("#master-toolbar-splice span.search");
    $("#master-toolbar-splice").children().appendTo($("#master-toolbar"));
    $("div.dataTables_length").remove();
    $("div.dataTables_filter").remove();
    $("#master-toolbar-splice").remove();
    $("#master-toolbar").addClass("ui-widget-header ui-corner-tl ui-corner-tr").css(
      "padding", "5pt").css("text-align", "center");
    new FixedHeader(oTable);
  });
</script> 
<table class="demo_jui display" id="test_runs">
  <thead>
    <tr>
      <th>{% trans "Test Run" %}</th>
      <th>{% trans "Uploaded On" %} </th>
      <th>{% trans "Analyzed" %}</th>
      <th>{% trans "Test" %}</th>
      {% comment %}
      <th>{% trans "Pass" %}</th>
      <th>{% trans "Fail" %}</th>
      <th>{% trans "Skip" %}</th>
      <th>{% trans "Unknown" %}</th>
      {% endcomment %}
    </tr>
  </thead>
  <tbody>
    {% for test_run in test_run_list %}
    <tr>
      <td><a href="{{ test_run.get_absolute_url }}"><code>{{ test_run.analyzer_assigned_uuid }}</code></a></td>
      <td>{{ test_run.bundle.uploaded_on }}</td>
      <td>{{ test_run.analyzer_assigned_date }}</td>
      <td><a href="{{ test_run.test.get_absolute_url }}">{{ test_run.test }}</a></td>
      {% comment %}
      {% with test_run.get_summary_results as summary %}
      <td>{{ summary.pass|default:0 }}</td>
      <td>{{ summary.fail|default:0 }}</td>
      <td>{{ summary.skip|default:0 }}</td>
      <td>{{ summary.unknown|default:0 }}</td>
      {% endwith %}
      {% endcomment %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}


{% block sidebar %}
<h3>{% trans "About" %}</h3>
<dl>
  <dt>{% trans "Pathname:" %}</dt>
  <dd>{{ bundle_stream.pathname }}</dd>
  <dt>{% trans "Name:" %}</dt>
  <dd>{{ bundle_stream.name|default:"<i>not set</i>" }}</dd>
</dl>
<h3>{% trans "Ownership" %}</h3>
{% if bundle_stream.user %}
<p>{% trans "This stream is owned by" %} <q>{{ bundle_stream.user }}</q></p>
{% else %}
<p>{% trans "This stream is owned by group called" %} <q>{{ bundle_stream.group }}</q></p>
{% endif %}
<h3>{% trans "Access rights" %}</h3>
<dl>
  <dt>{% trans "Stream type:" %}</dt>
  {% if bundle_stream.is_anonymous %}
  <dd>
  Anonymous stream <a href="#" id="what-are-anonymous-streams">(what is this?)</a>
  <div id="dialog-message" title="{% trans "About anonymous streams" %}">
    <p>The dashboard has several types of containers for test results. One of the
    most common and the oldest one is an <em>anonymous stream</em>. Anonymous
    streams act like public FTP servers. Anyone can download or upload files at
    will. There are some restrictions, nobody can change or remove existing
    files</p>

    <p>When a stream is anonymous anonyone can upload new test results and the
    identity of the uploading user is not recorded in the system. Anonymous
    streams have to be public (granting read access to everyone)</p>

    <div class="ui-widget">
      <div class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0.7em">
      <span class="ui-icon ui-icon-info" style="float: left; margin-right: 0.3em;"></span>
      <strong>Note:</strong> A stream can be marked as anonymous in the administration panel
      </div>
    </div>
  </div>
  <script type="text/javascript">
    $(function() {
        $( "#dialog-message" ).dialog({
          autoOpen: false,
          modal: true,
          minWidth: 500,
          buttons: {
            Ok: function() {
              $( this ).dialog( "close" );
            }
          }
        });
        $( "#what-are-anonymous-streams" ).click(function(e) {
          $( "#dialog-message").dialog('open');
        });
      });
  </script>
  </dd>
  <dt>{% trans "Read access:" %}</dt>
  <dd>{% trans "Anyone can download or read test results uploaded here" %}</dd>
  <dt>{% trans "Write access:" %}</dt>
  <dd>{% trans "Anyone can upload test results here" %}</dt>
  {% else %}
    {% if  bundle_stream.is_public %}
    <dd>{% trans "Public stream" %}</dd>
    <dt>{% trans "Read access:" %}</dt>
    <dd>{% trans "Anyone can download or read test results uploaded here" %}</dd>
    {% else %}
    <dd>{% trans "Private stream" %}</dd>
    <dt>{% trans "Read access:" %}</dt>
    <dd>{% trans "Only the owner can download or read test results uploaded here" %}</dd>
    {% endif %}
    <dt>{% trans "Write access:" %}</dt>
    <dd>{% trans "Only the owner can upload test results here" %}</dd>
  {% endif %}
</dl>
{% endblock %}
