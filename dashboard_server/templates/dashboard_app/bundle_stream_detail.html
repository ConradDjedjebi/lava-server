{% extends "base.html" %}
{% load i18n %}
{% load humanize %}


{% block title %}
| {% trans "Streams" %}
| {% trans "Bundle Stream" %} {{ bundle_stream.pathname }}
{% endblock %}


{% block breadcrumbs %}
<li><a href="{% url dashboard_app.views.bundle_stream_list %}">{% trans "Bundle Streams" %}</a></li>
<li>{{ bundle_stream.pathname }}</li>
{% endblock %}


{% block sidebar %}
<dl>
  <dt>{% trans "Pathname:" %}</dt>
  <dd>{{ bundle_stream.pathname }}</dd>
  <dt>{% trans "Access rights:" %}</dt>
  <dd>
  {% if bundle_stream.user %}
  This stream is private to {{ bundle_stream.user.username }}
  {% else %}
  {% if bundle_stream.group %}
  This stream is shared by group called {{ bundle_stream.group }}
  {% else %}
  {% blocktrans %}This stream is public{% endblocktrans %}
  {% endif %}
  {% endif %}
  </dd>
  <dt>{% trans "Name:" %}</dt>
  <dd>{{ bundle_stream.name|default:"<i>not set</i>" }}</dd>
</dl>
{% endblock %}


{% block content %}

{% if bundle_stream.bundles.count %}
<table class="data">
  <tr>
    <th rowspan="3">{% trans "Uploaded By" %}</th>
    <th rowspan="3">{% trans "Uploaded On" %}</th>
    <th style="width: 80%" colspan="6">{% trans "Analysis" %}</th>
  </tr>
  <tr>
    <th rowspan="2">{% trans "Test" %}</th>
    <th rowspan="2">{% trans "Ran On" %}</th>
    <th colspan="4">{% trans "Test Results" %}</th>
  </tr>
  <tr>
    <th>{% trans "Pass" %}</th>
    <th>{% trans "Fail" %}</th>
    <th>{% trans "Skip" %}</th>
    <th>{% trans "Unknown" %}</th>
  </tr>
  {% for bundle in bundle_stream.bundles.all %}
  <tr>
    <td rowspan="{{ bundle.test_runs.count|add:1 }}">{{ bundle.uploaded_by|default:"<i>anonymous</i>" }}</td>
    <td rowspan="{{ bundle.test_runs.count|add:1 }}">{{ bundle.uploaded_on|naturalday }} {{ bundle.uploaded_on|time }}</td>
    {% if bundle.is_deserialized %}
    {% for test_run in bundle.test_runs.all %}
    <tr>
      <td><a href="{{ test_run.get_absolute_url }}">{{ test_run.test }}</a></td>
      <td>{{ test_run.analyzer_assigned_date|naturalday }}</td>
      {% with test_run.get_summary_results as summary %}
      <td>{{ summary.pass|default:0 }}</td>
      <td>{{ summary.fail|default:0 }}</td>
      <td>{{ summary.skip|default:0 }}</td>
      <td>{{ summary.unknown|default:0 }}</td>
      {% endwith %}
    </tr>
    {% endfor %}
    {% else %}
    <td>
      {% if bundle.deserialization_error.count %}
        {% trans "deserialization failed" %}
      {% else %}
        {% trans "not deserialized yet" %}
      {% endif %}
    </td>
    <td colspan="5">
      {% if bundle.deserialization_error.count %}
        {{ bundle.deserialization_error.get.error_message }}
      {% endif %}
    </td>
    {% endif %}
  </tr>
  {% endfor %}
</table>

{% else %}

<p>{% blocktrans %}
  There are no bundles in this stream yet.
{% endblocktrans %}</p>

{% endif %}

{% endblock %}
