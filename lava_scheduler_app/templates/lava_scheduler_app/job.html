{% extends "lava_scheduler_app/job_sidebar.html" %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}lava_scheduler_app/js/jQuery.Rule.js"></script>
{% endblock %}


{% block content %}
<h2>Dispatcher Log Summary</h2>
{% if job_has_error %}
<div id="dispatcher-error">
<h3>Dispatcher error or test failure</h3>
<pre>{{ job_errors }}</pre>
</div>
{% endif %}
<h3>Dispatcher Log messages (file size = {{ job_file_size|filesizeformat }})</h3>
<span class="logbuttons">
{% for level in levels %}
{% if level.1 %}
  <input type="checkbox" checked="checked" id="{{ level.0 }}"/><label for="{{ level.0 }}">{{ level.0 }}</label>
{% endif %}
{% endfor %}
</span>
<div id="log_messages">
{% for log in job_log_messages %}
<pre class="log {{log.0}}">{{ log.1 }}</pre>
{% endfor %}
{% if job.status == job.RUNNING %}
<img src="{{ STATIC_URL }}lava_scheduler_app/images/ajax-progress.gif"/>
{% endif %}
</div>

<script type="text/javascript">
$('.logbuttons input').button()
$('.logbuttons input').click(function () {
    var rule = rules[$(this).attr('id')];
    if ($(this).is(':checked')) {
      rule.css('display', 'block');
    } else {
      rule.css('display', 'none');
    }
  }
)
var log_file_size = {{ job_file_size }};
var rules = {
{% for level in levels %}
{% if level.1 %}
 {{ level.0 }}: $.rule('pre.{{ level.0 }} {}').appendTo('style'),
{% endif %}
{% endfor %}
'': undefined
}
{% if job.status == job.RUNNING %}
console.log('hi');
{% endif %}
</script>
{% endblock %}

