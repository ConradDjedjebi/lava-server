.. _explain_first_job:

The first job in detail
#######################

Top level elements of a test job
********************************

* **comments** - V2 uses YAML for job submission precisely because YAML
  supports comments. **Please use comments liberally**. Comments are
  preserved in the job definition which can be viewed and downloaded from
  the instance. Comments are not passed to the dispatcher.
* **device_type** - a label which must match the type of device declared
  on the instance to which you want to submit this job. Each
  :term:`device type` can have one or more devices available. In this
  case, ``qemu``.
* **job_name** - your own free text name for this job. This name is used
  in the server side tables but has no further relevance for the dispatcher.
  There is no need to make this into a single long word with V2 - any valid
  YAML string is allowed, so commas, capitalisation and whitespace are fine.
* **timeouts** - a range of things can go wrong inside a LAVA test job, so
  the test writer needs to indicate how long parts of the job should take.
  This allows LAVA to fail jobs which have hung and return the device to
  scheduling for the next test job. Timeouts at the top level include
  the job, the default timeout per action and can include the default
  timeout for the device to respond using a connection.
* **priority** - supports values if ``high``, ``medium`` or ``low``. The
  scheduler considers the job priority when ordering the queue to consider
  which job should run next. **Do not abuse priority**.
* **visibility** - supports values of ``public``, ``personal`` and ``group``
  and controls who is allowed to view the job and the results generated by
  the job. This includes whether the results are available to queries and
  to charts.
* **context** - Not all testjobs will use a context, it is available to
  override some of the server-side device configuration templates. In this
  case, ``arch: amd64`` sets the template to use the ``qemu-system-x86_64``
  executable when starting the emulation.

.. code-block:: yaml

 # Sample JOB definition for an x86_64 QEMU
 device_type: qemu
 job_name: kvm-pipeline

 timeouts:
   job:
     minutes: 15
   action:
     minutes: 5
 priority: medium
 visibility: public
 context:
   arch: amd64

Actions within the test job
***************************



.. code-block:: yaml

 actions:

    - deploy:
        timeout:
          minutes: 5
        to: tmpfs
        images:
            rootfs:
              image_arg: -drive format=raw,file={rootfs}
              url: https://images.validation.linaro.org/kvm-debian-wheezy.img.gz
              compression: gz
        os: debian
        root_partition: 1

    - boot:
        method: qemu
        media: tmpfs
        prompts: ["root@debian:"]
        failure_retry: 2

    - test:
        failure_retry: 3
        name: kvm-basic-singlenode
        timeout:
          minutes: 5 # uses install:deps, so may take a few minutes
        definitions:
            - repository: git://git.linaro.org/qa/test-definitions.git
              from: git
              path: ubuntu/smoke-tests-basic.yaml
              name: smoke-tests
            - repository: https://git.linaro.org/lava-team/lava-functional-tests.git
              from: git
              path: lava-test-shell/single-node/singlenode03.yaml
              name: singlenode-advanced
